<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Smart Format Changer — Aranix</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg-1:#030513;
      --bg-2:#071027;
      --panel:#071226;
      --card:#0b1220;
      --muted:#95a0b8;
      --text:#e7eefc;
      --primary:#2f7df6;
      --primary-600:#1f61d6;
      --accent:#7c5cff;
      --radius:14px;
      --container-w:900px;
    }
    *{box-sizing:border-box}
    body {
      margin: 0;
      min-height: 100vh;
      font-family: Inter, "Segoe UI", Roboto, system-ui, -apple-system, "Helvetica Neue", Arial;
      background: linear-gradient(180deg,var(--bg-1),var(--bg-2));
      color: var(--text);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 32px 18px;
    }
    .container{width:100%;max-width:var(--container-w);padding:0 20px}
    .brand{text-align:center;margin-bottom:18px}
    .brand h1{margin:0;font-size:28px;font-weight:700;
      background:linear-gradient(90deg,var(--primary),var(--accent));
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;
      text-shadow:0 6px 24px rgba(47,125,246,0.06);
    }
    .banner{background:linear-gradient(135deg,rgba(47,125,246,0.06),rgba(124,92,255,0.03));
      border-radius:var(--radius);padding:22px;margin-bottom:22px;
      border:1px solid rgba(255,255,255,0.03);box-shadow:0 8px 30px rgba(2,6,23,0.6)}
    .banner h2{margin:0 0 8px 0;font-size:20px;font-weight:700;color:var(--text)}
    .banner p{margin:0;color:var(--muted);font-size:14px}
    .upload-card{background:linear-gradient(180deg,rgba(255,255,255,0.01),rgba(255,255,255,0.015));
      border-radius:14px;padding:18px;margin:10px 0;
      border:1px solid rgba(255,255,255,0.03);}
    .btn-primary{background:linear-gradient(90deg,var(--primary),var(--primary-600));
      border:none;color:white;padding:10px 16px;border-radius:10px;
      font-weight:600;cursor:pointer;box-shadow:0 8px 24px rgba(47,125,246,0.12);
      transition:opacity 0.2s;}
    .btn-primary:active{transform:translateY(1px)}
    .btn-primary:disabled{background:rgba(255,255,255,0.08);color:var(--muted);
      box-shadow:none;cursor:not-allowed;}
    #status{margin-top:12px;color:var(--muted);min-height:22px}
    .success{color:#4ade80}
    .error{color:#ff6b6b}
    .spinner{display:inline-block;width:20px;height:20px;
      border:3px solid rgba(255,255,255,0.2);
      border-top:3px solid var(--primary);
      border-radius:50%;animation:spin 1s linear infinite;
      vertical-align:middle;margin-right:8px}
    @keyframes spin{to{transform:rotate(360deg)}}
    .file-inputs{display:flex;flex-direction:column;gap:14px}
    .file-box{display:flex;flex-direction:column;gap:6px}
    .file-box strong{font-size:13px;color:var(--muted)}

    .file-chip {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: rgba(255,255,255,0.02);
      border-radius: 8px;
      padding: 6px 10px;
      border: 1px solid rgba(255,255,255,0.04);
    }
    .filename {
      flex: 1;
      font-size: 13px;
      color: var(--text);
      margin-left: 8px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .remove-btn {
      background: transparent;
      border: 0;
      color: var(--muted);
      cursor: pointer;
      font-size: 14px;
      padding: 4px;
      border-radius: 6px;
    }
    .remove-btn:hover { color:#ff6b6b; }

    .footer{margin-top:auto;font-size:0.9rem;color:var(--muted);
      width:100%;text-align:center}
      
    input[type="file"] {
      display: none; /* hide default browser "No file chosen" */
    }

  </style>
</head>
<body>
  <div class="container">

    <!-- Brand Logo Only -->
    <div style="display: flex; justify-content: center; align-items: center; margin-bottom: 1rem;">
      <img src="/AranixHelper_logo.png" alt="Aranix Helper Logo" style="height: 60px; width: auto;">
    </div>

    <!-- Banner -->
    <div class="banner">
      <h2>Smart Format Changer</h2>
      <p>Transform any input file into a clean base structure with header mapping</p>
    </div>

    <!-- Upload Section -->
    <section class="upload-card">
      <label style="display:block;font-weight:600;color:var(--muted);margin-bottom:10px;">
        Upload Files
      </label>

      <div class="file-inputs">
        <div class="file-box">
          <strong>Input File</strong>
          <div class="file-chip">
            <input id="inputFile" type="file" name="input_file" accept=".xls,.xlsx,.csv" />
            <span id="inputFileName" class="filename">No file chosen</span>
            <button type="button" id="removeInput" class="remove-btn" style="display:none;">✕</button>
          </div>
        </div>

        <div class="file-box">
          <strong>Base Structure File</strong>
          <div class="file-chip">
            <input id="baseFile" type="file" name="base_file" accept=".xls,.xlsx,.csv" />
            <span id="baseFileName" class="filename">No file chosen</span>
            <button type="button" id="removeBase" class="remove-btn" style="display:none;">✕</button>
          </div>
        </div>

        <div class="file-box">
          <strong>Header Matching File (Generate if you don't have)</strong>
          <div class="file-chip">
            <input id="hmFile" type="file" name="hm_file" accept=".xls,.xlsx,.csv" />
            <span id="hmFileName" class="filename">No file chosen</span>
            <button type="button" id="removeHM" class="remove-btn" style="display:none;">✕</button>
          </div>
        </div>
      </div>

      <div style="margin-top:16px;display:flex;gap:12px;">
        <button id="generateBtn" type="button" class="btn-primary">Generate HM File</button>
        <button id="transformBtn" type="button" class="btn-primary" disabled>Transform File</button>
      </div>

      <div id="status"></div>
    </section>
  </div>

  <!-- Footer -->
  <div class="footer">Made with <span>❤️</span> by Aranix</div>

<script>
  const inputFile = document.getElementById("inputFile");
  const baseFile = document.getElementById("baseFile");
  const hmFile = document.getElementById("hmFile");
  const generateBtn = document.getElementById("generateBtn");
  const transformBtn = document.getElementById("transformBtn");
  const statusText = document.getElementById("status");

  // filename spans + remove buttons
  const inputFileName = document.getElementById("inputFileName");
  const baseFileName = document.getElementById("baseFileName");
  const hmFileName = document.getElementById("hmFileName");
  const removeInput = document.getElementById("removeInput");
  const removeBase = document.getElementById("removeBase");
  const removeHM = document.getElementById("removeHM");

  function updateButtons() {
    const hasInput = inputFile.files.length > 0;
    const hasBase = baseFile.files.length > 0;
    const hasHM = hmFile.files.length > 0;

    // Transform enabled only if all 3 files present
    transformBtn.disabled = !(hasInput && hasBase && hasHM);

    // Generate enabled only if Input + Base chosen and HM not provided
    generateBtn.disabled = !(hasInput && hasBase && !hasHM);
  }

  function attachFileHandler(input, fileNameSpan, removeBtn) {
    input.addEventListener("change", () => {
      if (input.files.length > 0) {
        fileNameSpan.textContent = input.files[0].name;
        removeBtn.style.display = "inline-block";
      } else {
        fileNameSpan.textContent = "No file chosen";
        removeBtn.style.display = "none";
      }
      updateButtons();
    });

    removeBtn.addEventListener("click", () => {
      input.value = "";
      fileNameSpan.textContent = "No file chosen";
      removeBtn.style.display = "none";
      updateButtons();
    });
    
    // ✅ make filename clickable
    fileNameSpan.addEventListener("click", () => input.click());
  }

  // attach handlers
  attachFileHandler(inputFile, inputFileName, removeInput);
  attachFileHandler(baseFile, baseFileName, removeBase);
  attachFileHandler(hmFile, hmFileName, removeHM);

  // --- Generate HM File ---
  generateBtn.addEventListener("click", async () => {
    if (inputFile.files.length === 0 || baseFile.files.length === 0) {
      alert("Please select Input File and Base Structure File first.");
      return;
    }
    const formData = new FormData();
    formData.append("input_file", inputFile.files[0]);
    formData.append("base_file", baseFile.files[0]);

    statusText.innerHTML = '<span class="spinner"></span> Generating HM file...';

    const response = await fetch("https://web-production-1372f.up.railway.app/generate-hm", {
      method: "POST",
      body: formData
    });

    if (response.ok) {
      const blob = await response.blob();
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "Header_Matching_File.xlsx";
      link.click();
      statusText.innerText = "✅ HM File downloaded!";
      statusText.className = "success";
    } else {
      const err = await response.json();
      statusText.innerText = "❌ Error: " + err.error;
      statusText.className = "error";
    }
    updateButtons();
  });

  // --- Transform File ---
  transformBtn.addEventListener("click", async () => {
    if (inputFile.files.length === 0 || baseFile.files.length === 0 || hmFile.files.length === 0) {
      alert("Please select all three files.");
      return;
    }
    const formData = new FormData();
    formData.append("input_file", inputFile.files[0]);
    formData.append("base_file", baseFile.files[0]);
    formData.append("hm_file", hmFile.files[0]);

    statusText.innerHTML = '<span class="spinner"></span> Transforming file...';

    const response = await fetch("https://web-production-1372f.up.railway.app/transform", {
      method: "POST",
      body: formData
    });

    if (response.ok) {
      const blob = await response.blob();
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "Transformed_File.xlsx";
      link.click();
      statusText.innerText = "✅ File transformed successfully! Download started.";
      statusText.className = "success";
    } else {
      const err = await response.json();
      statusText.innerText = "❌ Error: " + err.error;
      statusText.className = "error";
    }
    updateButtons();
  });

  updateButtons();
</script>
</body>
</html>
